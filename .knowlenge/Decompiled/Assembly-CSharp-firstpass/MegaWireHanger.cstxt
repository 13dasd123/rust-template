using UnityEngine;

[ExecuteInEditMode]
[AddComponentMenu("Mega Wire/Hanger")]
public class MegaWireHanger : MonoBehaviour
{
	public MegaWire wire;

	public float alpha;

	public int strand;

	public float offset;

	public float weight = 1f;

	public bool align;

	public Vector3 rotate = Vector3.zero;

	private Quaternion locrot = Quaternion.identity;

	private Matrix4x4 wtm;

	public Transform parent;

	private void LateUpdate()
	{
		if (wire == null && parent != null)
		{
			wire = parent.GetComponentInChildren<MegaWire>();
		}
		if (!wire)
		{
			return;
		}
		Vector3 zero = Vector3.zero;
		if (alpha > 0f || alpha < 1f)
		{
			Vector3 vector = wire.SetWeight(alpha, strand, weight, snap: false);
			zero.x = vector.x;
			zero.y = vector.y + offset;
			zero.z = vector.z;
			Vector3 vector2 = wire.transform.localToWorldMatrix.MultiplyPoint(zero);
			base.transform.position = vector2;
			if (align)
			{
				Vector3 vector3 = wire.transform.localToWorldMatrix.MultiplyPoint(wire.SetWeight(alpha + 0.001f, strand, weight, snap: false));
				Vector3 forward = vector3 - vector2;
				Quaternion q = (locrot = Quaternion.LookRotation(forward, Vector3.up));
				wtm.SetTRS(vector2, q, Vector3.one);
				Quaternion quaternion = Quaternion.Euler(rotate);
				base.transform.rotation = locrot * quaternion;
			}
		}
	}
}
