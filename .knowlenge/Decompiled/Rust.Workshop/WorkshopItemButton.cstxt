using System.Linq;
using Rust.UI;
using Steamworks.Ugc;
using TMPro;
using UnityEngine;

internal class WorkshopItemButton : MonoBehaviour
{
	public TextMeshProUGUI Name;

	public TextMeshProUGUI Description;

	public HttpImage Icon;

	public GameObject OldIndicator;

	public GameObject Incompatible;

	public GameObject ItemDownloaded;

	public GameObject ItemDownloadPending;

	public GameObject ItemDownloading;

	private Item? Item;

	internal void Init(Item item)
	{
		Item = item;
		if ((bool)Name)
		{
			Name.text = Item?.Title;
		}
		if ((bool)Description)
		{
			Description.text = Item?.Description;
		}
		if (OldIndicator != null)
		{
			OldIndicator.SetActive(item.Tags.Contains("version2"));
		}
		if (Incompatible != null)
		{
			bool active = !item.Tags.Contains("version3") && !item.Tags.Contains("version2");
			Incompatible.SetActive(active);
		}
		if (Icon != null)
		{
			Icon.Load(Item?.PreviewImageUrl);
		}
		Update();
	}

	public void Update()
	{
		if (Item.HasValue)
		{
			if ((bool)ItemDownloaded)
			{
				ItemDownloaded.SetActive(Item.Value.IsInstalled);
			}
			if ((bool)ItemDownloadPending)
			{
				ItemDownloadPending.SetActive(Item.Value.IsDownloadPending);
			}
			if ((bool)ItemDownloading)
			{
				ItemDownloading.SetActive(Item.Value.IsDownloading);
			}
		}
	}

	public void OpenWebpage()
	{
		if (Item.HasValue)
		{
			Application.OpenURL(Item.Value.Url);
		}
	}

	public void StartEditing()
	{
		if (Item.HasValue)
		{
			SendMessageUpwards("StartEditingItem", Item.Value, SendMessageOptions.RequireReceiver);
		}
	}

	public void StartViewing()
	{
		if (Item.HasValue)
		{
			SendMessageUpwards("StartViewingItem", Item.Value, SendMessageOptions.RequireReceiver);
		}
	}
}
