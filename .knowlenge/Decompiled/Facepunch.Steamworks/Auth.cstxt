using System;
using System.Linq;
using Facepunch.Steamworks;

public class Auth
{
	public class Ticket : IDisposable
	{
		internal Client client;

		public byte[] Data;

		public uint Handle;

		public void Cancel()
		{
			if (client.IsValid && Handle != 0)
			{
				client.native.user.CancelAuthTicket(Handle);
				Handle = 0u;
				Data = null;
			}
		}

		public void Dispose()
		{
			Cancel();
		}
	}

	internal Client client;

	public unsafe Ticket GetAuthSessionTicket()
	{
		byte[] array = new byte[1024];
		fixed (byte* ptr = array)
		{
			uint pcbTicket = 0u;
			uint num = client.native.user.GetAuthSessionTicket((IntPtr)ptr, array.Length, out pcbTicket);
			if (num == 0)
			{
				return null;
			}
			return new Ticket
			{
				client = client,
				Data = array.Take((int)pcbTicket).ToArray(),
				Handle = num
			};
		}
	}
}
