using System;
using System.IO;
using System.Net;
using System.Text;

public static class Utility
{
	internal static class Epoch
	{
		private static readonly DateTime epoch = new DateTime(1970, 1, 1, 0, 0, 0, DateTimeKind.Utc);

		public static int Current => (int)DateTime.UtcNow.Subtract(epoch).TotalSeconds;

		public static DateTime ToDateTime(decimal unixTime)
		{
			return epoch.AddSeconds((long)unixTime);
		}

		public static uint FromDateTime(DateTime dt)
		{
			return (uint)dt.Subtract(epoch).TotalSeconds;
		}
	}

	internal static uint Swap(uint x)
	{
		return ((x & 0xFF) << 24) + ((x & 0xFF00) << 8) + ((x & 0xFF0000) >> 8) + ((x & 0xFF000000u) >> 24);
	}

	public static uint IpToInt32(this IPAddress ipAddress)
	{
		return Swap((uint)ipAddress.Address);
	}

	public static IPAddress Int32ToIp(uint ipAddress)
	{
		return new IPAddress(Swap(ipAddress));
	}

	internal static string FormatPrice(string currency, ulong price)
	{
		string arg = ((double)price / 100.0).ToString("0.00");
		return currency switch
		{
			"GBP" => $"£{arg}", 
			"USD" => $"${arg}", 
			"CAD" => $"${arg} CAD", 
			"EUR" => $"€{arg}", 
			"RUB" => $"₽{arg}", 
			"NZD" => $"${arg} NZD", 
			_ => $"{arg}{currency}", 
		};
	}

	public static string ReadNullTerminatedUTF8String(this BinaryReader br, byte[] buffer = null)
	{
		if (buffer == null)
		{
			buffer = new byte[1024];
		}
		int num = 0;
		byte b;
		while ((b = br.ReadByte()) != 0 && num < buffer.Length)
		{
			buffer[num] = b;
			num++;
		}
		return Encoding.UTF8.GetString(buffer, 0, num);
	}
}
