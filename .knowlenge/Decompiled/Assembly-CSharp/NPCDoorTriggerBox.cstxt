using Rust.Ai;
using UnityEngine;

public class NPCDoorTriggerBox : MonoBehaviour
{
	private Door door;

	private static int playerServerLayer = -1;

	public void Setup(Door door)
	{
		this.door = door;
		base.transform.SetParent(door.transform, worldPositionStays: false);
		base.gameObject.layer = 18;
		BoxCollider boxCollider = base.gameObject.AddComponent<BoxCollider>();
		boxCollider.isTrigger = true;
		boxCollider.center = Vector3.zero;
		boxCollider.size = Vector3.one * SquadManager.squad_door_trigger_size;
	}

	private void OnTriggerEnter(Collider other)
	{
		if (door == null || door.isClient || door.IsOpen() || door.IsLocked())
		{
			return;
		}
		if (playerServerLayer < 0)
		{
			playerServerLayer = LayerMask.NameToLayer("Player (Server)");
		}
		if ((other.gameObject.layer & playerServerLayer) > 0)
		{
			BasePlayer component = other.gameObject.GetComponent<BasePlayer>();
			if (component != null && component is NPCPlayer)
			{
				door.SetOpen(open: true);
			}
		}
	}
}
