using System;
using UnityEngine;

public class Model : MonoBehaviour, IPrefabPreProcess
{
	public SphereCollider collision;

	public Transform rootBone;

	public Transform headBone;

	public Transform eyeBone;

	public Animator animator;

	[HideInInspector]
	public Transform[] boneTransforms;

	[HideInInspector]
	public string[] boneNames;

	internal int skin;

	protected void OnEnable()
	{
		skin = -1;
	}

	public int GetSkin()
	{
		return skin;
	}

	private Transform FindBoneInternal(string name)
	{
		for (int i = 0; i < boneNames.Length; i++)
		{
			if (!(boneNames[i] != name))
			{
				return boneTransforms[i];
			}
		}
		return null;
	}

	public Transform FindBone(string name)
	{
		Transform result = rootBone;
		if (string.IsNullOrEmpty(name))
		{
			return result;
		}
		for (int i = 0; i < boneNames.Length; i++)
		{
			string text = boneNames[i];
			if (text.Equals(name, StringComparison.InvariantCultureIgnoreCase))
			{
				Transform transform = boneTransforms[i];
				if (!(transform == null))
				{
					result = transform;
					break;
				}
			}
		}
		return result;
	}

	public Transform FindClosestBone(Vector3 worldPos)
	{
		Transform result = rootBone;
		float num = float.MaxValue;
		for (int i = 0; i < boneTransforms.Length; i++)
		{
			Transform transform = boneTransforms[i];
			if (!(transform == null))
			{
				float num2 = Vector3.Distance(transform.position, worldPos);
				if (!(num2 >= num))
				{
					result = transform;
					num = num2;
				}
			}
		}
		return result;
	}

	public void PreProcess(IPrefabProcessor process, GameObject rootObj, string name, bool serverside, bool clientside, bool bundling)
	{
		if (!(this == null))
		{
			if (animator == null)
			{
				animator = GetComponent<Animator>();
			}
			if (rootBone == null)
			{
				rootBone = base.transform;
			}
			boneTransforms = rootBone.GetComponentsInChildren<Transform>(includeInactive: true);
			boneNames = new string[boneTransforms.Length];
			for (int i = 0; i < boneTransforms.Length; i++)
			{
				boneNames[i] = boneTransforms[i].name;
			}
		}
	}
}
