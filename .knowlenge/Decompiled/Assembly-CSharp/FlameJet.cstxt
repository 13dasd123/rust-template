using UnityEngine;

public class FlameJet : MonoBehaviour
{
	public LineRenderer line;

	public float tesselation = 0.025f;

	private float length;

	public float maxLength = 2f;

	public float drag;

	private int numSegments;

	public bool on;

	private Vector3[] lastWorldSegments;

	private Vector3[] currentSegments;

	public Color startColor;

	public Color endColor;

	public Color currentColor;

	private void Initialize()
	{
		currentColor = startColor;
	}

	private void Awake()
	{
		Initialize();
	}

	public void LateUpdate()
	{
		UpdateLine();
	}

	public void SetOn(bool isOn)
	{
		on = isOn;
	}

	private float curve(float x)
	{
		return x * x;
	}

	private void UpdateLine()
	{
		currentColor.a = Mathf.Lerp(currentColor.a, (!on) ? 0f : 1f, Time.deltaTime * 40f);
		line.SetColors(currentColor, endColor);
		tesselation = 0.1f;
		numSegments = Mathf.CeilToInt(maxLength / tesselation);
		float num = maxLength / (float)numSegments;
		Vector3[] array = new Vector3[numSegments];
		for (int i = 0; i < array.Length; i++)
		{
			float x = 0f;
			float y = 0f;
			if (lastWorldSegments != null && lastWorldSegments[i] != Vector3.zero)
			{
				Vector3 a = base.transform.InverseTransformPoint(lastWorldSegments[i]);
				float f = (float)i / (float)array.Length;
				Vector3 b = Vector3.Lerp(a, Vector3.zero, Time.deltaTime * drag);
				b = Vector3.Lerp(Vector3.zero, b, Mathf.Sqrt(f));
				x = b.x;
				y = b.y;
			}
			if (i == 0)
			{
				x = (y = 0f);
			}
			Vector3 vector = new Vector3(x, y, (float)i * num);
			array[i] = vector;
			if (lastWorldSegments == null)
			{
				lastWorldSegments = new Vector3[numSegments];
			}
			ref Vector3 reference = ref lastWorldSegments[i];
			reference = base.transform.TransformPoint(vector);
		}
		line.SetVertexCount(numSegments);
		line.SetPositions(array);
	}
}
