using System;

public class RPC_Server : RPC_Shared
{
	public abstract class Conditional : Attribute
	{
		public virtual string GetArgs()
		{
			return null;
		}
	}

	public class MaxDistance : Conditional
	{
		private float maximumDistance;

		public MaxDistance(float maxDist)
		{
			maximumDistance = maxDist;
		}

		public override string GetArgs()
		{
			return maximumDistance.ToString("0.00f");
		}

		public static bool Test(string debugName, BaseEntity ent, BasePlayer player, float maximumDistance)
		{
			if (ent == null || player == null)
			{
				return false;
			}
			return ent.Distance(player.eyes.position) <= maximumDistance;
		}
	}

	public class IsVisible : Conditional
	{
		private float maximumDistance;

		public IsVisible(float maxDist)
		{
			maximumDistance = maxDist;
		}

		public override string GetArgs()
		{
			return maximumDistance.ToString("0.00f");
		}

		public static bool Test(string debugName, BaseEntity ent, BasePlayer player, float maximumDistance)
		{
			if (ent == null || player == null)
			{
				return false;
			}
			return GamePhysics.LineOfSight(player.eyes.center, player.eyes.position, 2162688) && (ent.IsVisible(player.eyes.HeadRay(), maximumDistance) || ent.IsVisible(player.eyes.position, maximumDistance));
		}
	}

	public class FromOwner : Conditional
	{
		public static bool Test(string debugName, BaseEntity ent, BasePlayer player)
		{
			if (ent == null || player == null)
			{
				return false;
			}
			if (ent.net == null || player.net == null)
			{
				return false;
			}
			if (ent.net.ID == player.net.ID)
			{
				return true;
			}
			if (ent.parentEntity.uid != player.net.ID)
			{
				return false;
			}
			return true;
		}
	}

	public class IsActiveItem : Conditional
	{
		public static bool Test(string debugName, BaseEntity ent, BasePlayer player)
		{
			if (ent == null || player == null)
			{
				return false;
			}
			if (ent.net == null || player.net == null)
			{
				return false;
			}
			if (ent.net.ID == player.net.ID)
			{
				return true;
			}
			if (ent.parentEntity.uid != player.net.ID)
			{
				return false;
			}
			Item activeItem = player.GetActiveItem();
			if (activeItem == null)
			{
				return false;
			}
			if (activeItem.GetHeldEntity() != ent)
			{
				return false;
			}
			return true;
		}
	}
}
