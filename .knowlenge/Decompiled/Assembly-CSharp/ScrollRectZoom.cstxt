using UnityEngine;
using UnityEngine.EventSystems;
using UnityEngine.UI;

public class ScrollRectZoom : MonoBehaviour, IScrollHandler, IEventSystemHandler
{
	public ScrollRectEx scrollRect;

	public float zoom = 1f;

	public bool smooth = true;

	public float max = 1.5f;

	public float min = 0.5f;

	public float velocity;

	public RectTransform rectTransform => scrollRect.transform as RectTransform;

	private void OnEnable()
	{
		SetZoom(zoom);
	}

	public void OnScroll(PointerEventData data)
	{
		velocity += data.scrollDelta.y * 0.001f;
		velocity = Mathf.Clamp(velocity, -1f, 1f);
	}

	private void Update()
	{
		velocity = Mathf.Lerp(velocity, 0f, Time.deltaTime * 10f);
		SetZoom(zoom + velocity);
	}

	private void SetZoom(float z)
	{
		z = Mathf.Clamp(z, min, max);
		if (z != zoom)
		{
			zoom = z;
			Rect rect = (scrollRect.transform as RectTransform).rect;
			Vector2 vector = scrollRect.content.rect.size * zoom;
			Vector2 normalizedPosition = scrollRect.normalizedPosition;
			if (vector.x < rect.width)
			{
				zoom = rect.width / scrollRect.content.rect.size.x;
			}
			if (vector.y < rect.height)
			{
				zoom = rect.height / scrollRect.content.rect.size.y;
			}
			scrollRect.content.localScale = Vector3.one * zoom;
			scrollRect.normalizedPosition = normalizedPosition;
		}
	}
}
