using System.Collections;
using Apex.Ai.HTN;
using UnityEngine;

public class Stand : OperatorBase<ScientistContext>
{
	public override void Execute(ScientistContext context)
	{
		context.Body.StartCoroutine(AsyncTimer(context, 0.3f));
	}

	public override OperatorStateType Tick(ScientistContext context, PrimitiveTaskSelector task)
	{
		if (context.IsFact(Facts.IsStandingUp))
		{
			return OperatorStateType.Running;
		}
		ApplyExpectedEffects(context, task);
		return OperatorStateType.Complete;
	}

	public override void Abort(ScientistContext context, PrimitiveTaskSelector task)
	{
		context.Body.StopCoroutine(AsyncTimer(context, 0f));
		Reset(context);
	}

	private IEnumerator AsyncTimer(ScientistContext context, float time)
	{
		context.SetFact(Facts.IsStandingUp, value: true);
		yield return CoroutineEx.waitForSeconds(time);
		context.Body.modelState.ducked = false;
		context.SetFact(Facts.IsDucking, value: false);
		yield return CoroutineEx.waitForSeconds(time);
		context.SetFact(Facts.IsStandingUp, value: false);
	}

	private void Reset(ScientistContext context)
	{
		context.Body.modelState.ducked = false;
		context.SetFact(Facts.IsDucking, value: false);
		context.SetFact(Facts.IsStandingUp, value: false);
	}
}
