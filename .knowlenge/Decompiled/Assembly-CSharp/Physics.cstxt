using UnityEngine;

[Factory("physics")]
public class Physics : ConsoleSystem
{
	private const float baseGravity = -9.81f;

	[ServerVar(Help = "The physics mode that dropped items and corpses should use. good, tempgood or fast. fast + tempgood might cause objects to fall through other objects.")]
	public static string droppedmode = "good";

	[ServerVar(Help = "Send effects to clients when physics objects collide")]
	public static bool sendeffects = true;

	[ServerVar]
	public static float bouncethreshold
	{
		get
		{
			return Physics.bounceThreshold;
		}
		set
		{
			Physics.bounceThreshold = value;
		}
	}

	[ServerVar]
	public static float sleepthreshold
	{
		get
		{
			return Physics.sleepThreshold;
		}
		set
		{
			Physics.sleepThreshold = value;
		}
	}

	[ServerVar(Help = "The default solver iteration count permitted for any rigid bodies (default 7). Must be positive")]
	public static int solveriterationcount
	{
		get
		{
			return Physics.defaultSolverIterations;
		}
		set
		{
			Physics.defaultSolverIterations = value;
		}
	}

	[ServerVar(Help = "Gravity multiplier")]
	public static float gravity
	{
		get
		{
			return Physics.gravity.y / -9.81f;
		}
		set
		{
			Physics.gravity = new Vector3(0f, value * -9.81f, 0f);
		}
	}

	[ClientVar]
	[ServerVar(Help = "The amount of physics steps per second")]
	public static float steps
	{
		get
		{
			return 1f / Time.fixedDeltaTime;
		}
		set
		{
			if (value < 10f)
			{
				value = 10f;
			}
			if (value > 60f)
			{
				value = 60f;
			}
			Time.fixedDeltaTime = 1f / value;
		}
	}

	[ClientVar]
	[ServerVar(Help = "The slowest physics steps will operate")]
	public static float minsteps
	{
		get
		{
			return 1f / Time.maximumDeltaTime;
		}
		set
		{
			if (value < 1f)
			{
				value = 1f;
			}
			if (value > 60f)
			{
				value = 60f;
			}
			Time.maximumDeltaTime = 1f / value;
		}
	}

	internal static void ApplyDropped(Rigidbody rigidBody, BaseEntity entity)
	{
		if (droppedmode == "good")
		{
			rigidBody.collisionDetectionMode = CollisionDetectionMode.ContinuousDynamic;
		}
		if (droppedmode == "tempgood")
		{
			rigidBody.collisionDetectionMode = CollisionDetectionMode.ContinuousDynamic;
			entity.Invoke(entity.SwitchToFastPhysics, 10f);
		}
		if (droppedmode == "fast")
		{
			rigidBody.collisionDetectionMode = CollisionDetectionMode.Discrete;
		}
	}
}
