using System.Diagnostics;
using Facepunch;
using UnityEngine;
using UnityEngine.UI;

public class ErrorText : MonoBehaviour
{
	public Text text;

	public int maxLength = 1024;

	private Stopwatch stopwatch;

	public void OnEnable()
	{
		Output.OnMessage += CaptureLog;
	}

	public void OnDisable()
	{
		Output.OnMessage -= CaptureLog;
	}

	internal void CaptureLog(string error, string stacktrace, LogType type)
	{
		if (type == LogType.Error || type == LogType.Exception || type == LogType.Assert)
		{
			Text obj = this.text;
			string text = obj.text;
			obj.text = text + error + "\n" + stacktrace + "\n\n";
			if (this.text.text.Length > maxLength)
			{
				this.text.text = this.text.text.Substring(this.text.text.Length - maxLength, maxLength);
			}
			stopwatch = Stopwatch.StartNew();
		}
	}

	protected void Update()
	{
		if (stopwatch != null && stopwatch.Elapsed.TotalSeconds > 30.0)
		{
			text.text = string.Empty;
			stopwatch = null;
		}
	}
}
