using System;
using Rust.Ai.Gen2;
using UnityEngine;

[SoftRequireComponent(typeof(RootMotionPlayer))]
public abstract class State_PlayAnimationBase : FSMStateBase
{
	[SerializeField]
	public bool FaceTarget;

	private EFSMStateStatus _status;

	private Action _succeedAction;

	protected Action SucceedAction => Succeed;

	public override EFSMStateStatus OnStateEnter()
	{
		if (FaceTarget && Owner.GetTargetPosition(out var targetPos))
		{
			Vector3 forward = targetPos - Owner.transform.position;
			forward.y = 0f;
			Owner.transform.rotation = Quaternion.LookRotation(forward);
		}
		return base.OnStateEnter();
	}

	public override EFSMStateStatus OnStateUpdate(float deltaTime)
	{
		return _status;
	}

	public override void OnStateExit()
	{
		base.AnimPlayer.StopServer();
		_status = EFSMStateStatus.None;
	}

	private void Succeed()
	{
		_status = EFSMStateStatus.Success;
	}
}
