using System;
using UnityEngine;
using UnityEngine.UI;

public class TweakUIDropdown : MonoBehaviour
{
	[Serializable]
	public class NameValue
	{
		public string value;

		public Color imageColor;

		public Translate.Phrase label;
	}

	public Button Left;

	public Button Right;

	public Text Current;

	public Image BackgroundImage;

	public NameValue[] nameValues;

	public string convarName = "effects.motionblur";

	public bool assignImageColor;

	internal ConsoleSystem.Command conVar;

	public int currentValue;

	protected void Awake()
	{
		conVar = ConsoleSystem.Index.Client.Find(convarName);
		if (conVar == null)
		{
			Debug.LogWarning("TweakUIDropDown Convar Missing: " + convarName);
		}
		else
		{
			UpdateState();
		}
	}

	protected void OnEnable()
	{
		UpdateState();
	}

	public void OnValueChanged()
	{
		UpdateConVar();
	}

	public void ChangeValue(int change)
	{
		currentValue += change;
		if (currentValue < 0)
		{
			currentValue = 0;
		}
		if (currentValue > nameValues.Length - 1)
		{
			currentValue = nameValues.Length - 1;
		}
		Left.interactable = currentValue > 0;
		Right.interactable = currentValue < nameValues.Length - 1;
		UpdateConVar();
	}

	private void UpdateConVar()
	{
		NameValue nameValue = nameValues[currentValue];
		if (conVar != null && !(conVar.String == nameValue.value))
		{
			conVar.Set(nameValue.value);
			UpdateState();
		}
	}

	private void UpdateState()
	{
		if (conVar == null)
		{
			return;
		}
		string @string = conVar.String;
		for (int i = 0; i < nameValues.Length; i++)
		{
			if (!(nameValues[i].value != @string))
			{
				Current.text = nameValues[i].label.translated;
				currentValue = i;
				if (assignImageColor)
				{
					BackgroundImage.color = nameValues[i].imageColor;
				}
			}
		}
	}
}
