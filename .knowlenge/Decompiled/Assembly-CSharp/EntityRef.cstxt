using UnityEngine;

public struct EntityRef
{
	internal BaseEntity ent_cached;

	internal uint id_cached;

	public uint uid
	{
		get
		{
			if (ent_cached.IsValid())
			{
				id_cached = ent_cached.net.ID;
			}
			return id_cached;
		}
		set
		{
			id_cached = value;
			if (id_cached == 0)
			{
				ent_cached = null;
			}
			else if (!ent_cached.IsValid() || ent_cached.net.ID != id_cached)
			{
				ent_cached = null;
			}
		}
	}

	public bool IsSet()
	{
		return id_cached != 0;
	}

	public bool IsValid(bool serverside)
	{
		return Get(serverside).IsValid();
	}

	public void Set(BaseEntity ent)
	{
		ent_cached = ent;
		id_cached = 0u;
		if (ent_cached.IsValid())
		{
			id_cached = ent_cached.net.ID;
		}
	}

	public BaseEntity Get(bool serverside)
	{
		if (ent_cached == null && id_cached != 0)
		{
			if (serverside)
			{
				ent_cached = BaseNetworkable.serverEntities.Find(id_cached) as BaseEntity;
			}
			else
			{
				Debug.LogWarning("EntityRef: Looking for clientside entities on pure server!");
			}
		}
		if (!ent_cached.IsValid())
		{
			ent_cached = null;
		}
		return ent_cached;
	}
}
