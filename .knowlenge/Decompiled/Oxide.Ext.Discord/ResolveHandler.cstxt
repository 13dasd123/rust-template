using System;
using Oxide.Ext.Discord;
using Oxide.Ext.Discord.Interfaces;
using Oxide.Ext.Discord.Logging;

internal readonly struct ResolveHandler<TPromised>
{
	private readonly Action<TPromised> _resolve;

	private readonly IRejectable _rejectable;

	public ResolveHandler(Action<TPromised> resolve, IRejectable rejectable)
	{
		_resolve = resolve;
		_rejectable = rejectable;
	}

	public void Resolve(TPromised value)
	{
		try
		{
			_resolve(value);
		}
		catch (Exception ex)
		{
			DiscordExtension.GlobalLogger.Exception("An error occured during resolve of Promise<" + typeof(TPromised).Name + ">", ex);
			_rejectable.Reject(ex);
		}
	}
}
