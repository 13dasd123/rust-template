using System;
using Oxide.Ext.Discord.Entities;
using Oxide.Ext.Discord.Factory;
using Oxide.Ext.Discord.Types;

public sealed class SnowflakeIdFactory : Singleton<SnowflakeIdFactory>
{
	private DateTimeOffset _currentTime;

	private ulong _increment;

	private readonly TimeSpan _diffCompare = TimeSpan.FromMilliseconds(1.0);

	private readonly object _sync = new object();

	private SnowflakeIdFactory()
	{
	}

	public Snowflake Generate()
	{
		lock (_sync)
		{
			if (DateTimeOffset.UtcNow - _currentTime >= _diffCompare)
			{
				_currentTime = DateTimeOffset.UtcNow;
				_increment = 0uL;
			}
			Snowflake result = new Snowflake(_currentTime, _increment);
			_increment++;
			return result;
		}
	}
}
